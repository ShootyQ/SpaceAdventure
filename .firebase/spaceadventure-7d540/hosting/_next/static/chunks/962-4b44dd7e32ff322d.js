"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[962],{7962:function(e,t,a){a.d(t,{Z:function(){return A}});var r=a(3827),i=a(4090),s=a(8745),l=a(8371),n=a(9251),o=a(1562),c=a(3861),d=a(7021),u=a(3195),x=a(94),h=a(7271),m=a(5751),p=a(5693),b=a(1652),g=a(7404),f=a(9496),v=a(1213),w=a(5462),y=a(8943),j=a(1361),N=a(6678),k=a(8121),S=a(4499),z=a(1657),_=a(9259),C=a(5802);let E=(0,i.memo)(e=>{let{config:t}=e,a=e=>({red:"#ef4444",blue:"#3b82f6",green:"#22c55e",yellow:"#eab308",purple:"#a855f7",black:"#171717",white:"#f8fafc",orange:"#f97316"})[e]||"#3b82f6",i=a(t.primaryColor),s=a(t.secondaryColor),l="mf-clip-".concat(t.primaryColor,"-").concat(t.secondaryColor,"-").concat(t.pattern,"-").concat(t.shape).replace(/[^a-z0-9]/gi,"");return(0,r.jsxs)("svg",{width:"24",height:"30",viewBox:"0 0 24 30",className:"drop-shadow-md",children:[(0,r.jsx)("rect",{x:"2",y:"2",width:"2",height:"28",rx:"1",fill:{silver:"#cbd5e1",gold:"#eab308",wood:"#854d0e",black:"#262626"}[t.pole]||"#cbd5e1"}),(0,r.jsxs)("g",{transform:"translate(4, 3)",children:[(0,r.jsx)("defs",{children:(0,r.jsxs)("clipPath",{id:l,children:["rectangle"===t.shape&&(0,r.jsx)("rect",{x:"0",y:"0",width:"20",height:"12"}),"pennant"===t.shape&&(0,r.jsx)("polygon",{points:"0,0 20,6 0,12"}),"triangle"===t.shape&&(0,r.jsx)("polygon",{points:"0,0 20,0 10,12 0,0"}),"swallowtail"===t.shape&&(0,r.jsx)("polygon",{points:"0,0 20,0 20,12 10,6 0,12"})]})}),(0,r.jsxs)("g",{clipPath:"url(#".concat(l,")"),children:["solid"===t.pattern&&(0,r.jsx)("rect",{x:"0",y:"0",width:"20",height:"12",fill:i}),"stripe-h"===t.pattern&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("rect",{x:"0",y:"0",width:"20",height:"12",fill:i}),(0,r.jsx)("rect",{x:"0",y:"6",width:"20",height:"6",fill:s})]}),"stripe-v"===t.pattern&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("rect",{x:"0",y:"0",width:"20",height:"12",fill:i}),(0,r.jsx)("rect",{x:"10",y:"0",width:"10",height:"12",fill:s})]}),"cross"===t.pattern&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("rect",{x:"0",y:"0",width:"20",height:"12",fill:i}),(0,r.jsx)("rect",{x:"8",y:"0",width:"4",height:"12",fill:s}),(0,r.jsx)("rect",{x:"0",y:"4",width:"20",height:"4",fill:s})]}),"circle"===t.pattern&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("rect",{x:"0",y:"0",width:"20",height:"12",fill:i}),(0,r.jsx)("circle",{cx:"10",cy:"6",r:"4",fill:s})]}),"checkered"===t.pattern&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("rect",{x:"0",y:"0",width:"10",height:"6",fill:i}),(0,r.jsx)("rect",{x:"10",y:"0",width:"10",height:"6",fill:s}),(0,r.jsx)("rect",{x:"0",y:"6",width:"10",height:"6",fill:s}),(0,r.jsx)("rect",{x:"10",y:"6",width:"10",height:"6",fill:i})]})]})]})]})});E.displayName="TinyFlag";let P=(0,i.memo)(e=>{let{student:t,ranks:a,isSelected:s,onToggle:l}=e,n=i.useMemo(()=>a.find(e=>t.xp>=e.minXP),[a,t.xp]);return(0,r.jsxs)("div",{onClick:l,className:"relative group cursor-pointer transition-all hover:scale-105 p-4 rounded-2xl border flex flex-col items-center\n                ".concat(s?"bg-cyan-900/40 border-cyan-400 shadow-[0_0_20px_rgba(34,211,238,0.3)]":"bg-white/5 border-white/10 hover:bg-white/10 hover:border-cyan-500/50"),children:[(0,r.jsx)("div",{className:"absolute top-2 left-2 w-5 h-5 rounded border flex items-center justify-center transition-colors ".concat(s?"bg-cyan-500 border-cyan-500 text-black":"border-white/30 group-hover:border-cyan-400"),children:s&&(0,r.jsx)(_.Z,{size:14,strokeWidth:4})}),(0,r.jsx)("div",{className:"absolute top-2 right-2 flex flex-col items-end",children:(0,r.jsxs)("div",{className:"bg-green-500 text-black text-xs font-bold px-2 py-0.5 rounded-full shadow-[0_0_10px_rgba(34,197,94,0.5)]",children:[t.xp," XP"]})}),(0,r.jsxs)("div",{className:"relative w-32 h-32 mb-4",children:[(0,r.jsx)("img",{src:(0,z.K)("/images/ships/finalship.png"),alt:"Ship",className:"w-full h-full object-contain drop-shadow-[0_0_15px_rgba(255,255,255,0.2)] relative z-20"}),(0,r.jsx)("div",{className:"absolute top-[22%] left-[26%] w-[48%] h-[30%] z-30 rounded-full overflow-hidden bg-cyan-900/20",children:(0,r.jsx)(C.Yt,{userData:t,className:"w-full h-full scale-[1.35] translate-y-1"})}),t.flag&&(0,r.jsx)("div",{className:"absolute -top-2 -left-2 z-40 transform -rotate-12 scale-110 drop-shadow-md",children:(0,r.jsx)(E,{config:t.flag})})]}),(0,r.jsxs)("div",{className:"text-center w-full mb-4",children:[(0,r.jsx)("h3",{className:"text-white font-bold truncate w-full mb-1",children:t.cadetName}),(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center gap-1",children:[(null==n?void 0:n.image)&&(0,r.jsx)("img",{src:(0,z.K)(n.image),alt:n.name,className:"w-16 h-16 md:w-20 md:h-20 object-contain drop-shadow-md my-2"}),(0,r.jsx)("div",{className:"text-xs uppercase tracking-wider font-bold ".concat(((null==n?void 0:n.minXP)||0)>3e3?"text-amber-400 drop-shadow-[0_0_8px_rgba(251,191,36,0.8)] text-sm":((null==n?void 0:n.minXP)||0)>1e3?"text-cyan-300 drop-shadow-[0_0_5px_rgba(34,211,238,0.5)]":"text-cyan-400/70"),children:(null==n?void 0:n.name)||"Recruit"})]})]}),(0,r.jsxs)("div",{className:"mt-4 flex items-center gap-2 text-[10px] text-gray-400 uppercase tracking-widest bg-black/30 px-2 py-1 rounded",children:[(0,r.jsx)("div",{className:"w-2 h-2 rounded-full ".concat("traveling"===t.status?"bg-orange-400 animate-pulse":"bg-green-400")}),"traveling"===t.status?"In Transit":"Docked"]})]})});P.displayName="ShipCard";let I=(0,i.memo)(e=>{let{isVisible:t,onClose:a,ships:n,ranks:o,selectedIds:d,setSelectedIds:x,behaviors:h}=e,m=i.useMemo(()=>o.slice().sort((e,t)=>t.minXP-e.minXP),[o]),p=i.useMemo(()=>n.filter(e=>"teacher"!==e.role).sort((e,t)=>t.xp-e.xp),[n]),b=i.useCallback(e=>{let t=new Set(d);t.has(e)?t.delete(e):t.add(e),x(t)},[d,x]);return t?(0,r.jsx)(s.M,{children:(0,r.jsx)(l.E.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:50},className:"absolute inset-0 z-50 bg-black/80 backdrop-blur-md p-10 overflow-y-auto",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto pb-40",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,r.jsxs)("h2",{className:"text-3xl font-bold text-white uppercase tracking-widest flex items-center gap-4",children:[(0,r.jsx)(u.Z,{className:"text-cyan-400"}),"Fleet Manifest"]}),(0,r.jsx)("div",{className:"flex gap-4",children:(0,r.jsx)("button",{onClick:()=>{x(new Set),a()},className:"text-gray-400 hover:text-white px-4 py-2 border border-white/20 rounded hover:bg-white/10 transition",children:"CLOSE MANIFEST"})})]}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6",children:p.map(e=>(0,r.jsx)(P,{student:e,ranks:m,isSelected:d.has(e.id),onToggle:()=>b(e.id)},e.id))}),(0,r.jsx)(s.M,{children:d.size>0&&(0,r.jsxs)(l.E.div,{initial:{y:100},animate:{y:0},exit:{y:100},className:"fixed bottom-0 left-0 right-0 bg-black/95 border-t border-cyan-500/30 p-6 z-[60] flex items-center justify-center gap-6 shadow-[0_-10px_40px_rgba(0,0,0,0.8)]",children:[(0,r.jsxs)("div",{className:"text-white font-bold uppercase tracking-widest text-sm bg-cyan-900/30 px-4 py-2 rounded",children:[d.size," Cadets Selected"]}),(0,r.jsx)("div",{className:"h-8 w-px bg-white/20"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"relative group",children:[(0,r.jsxs)("select",{id:"bulk-protocol",onClick:e=>e.stopPropagation(),onChange:e=>{let t=document.getElementById("bulk-xp"),a=document.getElementById("bulk-reason"),r=h.find(t=>t.id===e.target.value);r&&t&&a&&(t.value=r.xp.toString(),a.value=r.label)},className:"bg-black border border-white/20 text-white pl-4 pr-10 py-2 rounded w-48 focus:border-cyan-500 outline-none appearance-none cursor-pointer hover:border-cyan-500/50 z-[70]",children:[(0,r.jsx)("option",{value:"",className:"bg-black text-gray-500",children:"Select Protocol..."}),h.map(e=>(0,r.jsxs)("option",{value:e.id,className:"bg-black text-white hover:bg-white/20",children:[e.label," (",e.xp>0?"+":"",e.xp," XP)"]},e.id))]}),(0,r.jsx)("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-cyan-500",children:(0,r.jsx)(c.Z,{size:12})})]}),(0,r.jsx)("input",{type:"number",id:"bulk-xp",placeholder:"XP",className:"bg-black border border-white/20 text-white px-4 py-2 rounded w-24 text-center font-bold focus:border-cyan-500 outline-none z-[70]",onClick:e=>e.stopPropagation()}),(0,r.jsx)("input",{type:"text",id:"bulk-reason",placeholder:"Reason (Optional)",className:"bg-black border border-white/20 text-white px-4 py-2 rounded w-64 focus:border-cyan-500 outline-none z-[70]",onClick:e=>e.stopPropagation()})]}),(0,r.jsx)("button",{className:"bg-green-600 hover:bg-green-500 text-white font-bold px-6 py-2 rounded shadow-[0_0_15px_rgba(34,197,94,0.4)] z-[70]",onClick:async e=>{e.preventDefault(),e.stopPropagation();let t=parseInt(document.getElementById("bulk-xp").value)||0,a=document.getElementById("bulk-reason").value||"Command Award";if(0===t)return;let r=Array.from(d).map(async e=>{let r=(0,k.JU)(S.db,"users",e);try{await (0,k.i3)(S.db,async e=>{var i;let s=await e.get(r);if(!s.exists())return;let l=s.data(),n=(null===(i=l.upgrades)||void 0===i?void 0:i.fuel)||0,o=500+250*n,c=(void 0!==l.fuel?l.fuel:500)+t;if(c>o&&(c=o),c<0&&(c=0),e.update(r,{xp:(0,k.nP)(t),fuel:c,lastAward:{reason:a,xpGained:t,timestamp:Date.now()},lastXpReason:a}),l.teacherId&&t>0){let a=(0,k.JU)(S.db,"users/".concat(l.teacherId,"/settings"),"classBonus");e.set(a,{current:(0,k.nP)(t)},{merge:!0})}let d=l.location,u="traveling"===l.travelStatus;if(d&&t>0&&!u&&l.teacherId){let a=d.toLowerCase(),r=(0,k.JU)(S.db,"users/".concat(l.teacherId,"/planets"),a);e.set(r,{currentXP:(0,k.nP)(t),id:a},{merge:!0})}})}catch(t){console.error("Failed to update student ".concat(e,":"),t)}});await Promise.all(r),x(new Set),document.getElementById("bulk-xp").value="",document.getElementById("bulk-reason").value=""},children:"Award XP"}),(0,r.jsx)("button",{onClick:()=>x(new Set),className:"text-red-400 hover:text-white text-sm uppercase font-bold tracking-wider ml-4",children:"Clear Selection"})]})})]})})}):null});I.displayName="ManifestOverlay";var M=a(2225);let R=[{id:"1",name:"Space Cadet",minXP:0,image:"/images/badges/cadet.png"},{id:"2",name:"Rookie Pilot",minXP:100,image:"/images/badges/RookiePilot.png"},{id:"3",name:"Star Scout",minXP:300,image:"/images/badges/StarScout.png"},{id:"4",name:"Nebula Navigator",minXP:600,image:"/images/badges/NebulaNavigator.png"},{id:"5",name:"Solar Specialist",minXP:1e3,image:"/images/badges/SolarSpecialist.png"},{id:"6",name:"Comet Captain",minXP:1500,image:"/images/badges/CometCaptain.png"},{id:"7",name:"Galaxy Guardian",minXP:2200,image:"/images/badges/GalaxyGuardian.png"},{id:"8",name:"Cosmic Commander",minXP:3e3,image:"/images/badges/CosmicCommander.png"},{id:"9",name:"Void Admiral",minXP:4e3,image:"/images/badges/VoidAdmiral.png"},{id:"10",name:"Grand Star Admiral",minXP:5e3,image:"/images/badges/GrandStarAdmiral.png"}],D=e=>{let{config:t}=e,a=e=>({red:"#ef4444",blue:"#3b82f6",green:"#22c55e",yellow:"#eab308",purple:"#a855f7",black:"#171717",white:"#f8fafc",orange:"#f97316"})[e]||"#3b82f6",i=a(t.primaryColor),s=a(t.secondaryColor),l="clip-".concat(t.primaryColor,"-").concat(t.secondaryColor,"-").concat(t.pattern,"-").concat(t.shape).replace(/[^a-z0-9]/gi,"");return(0,r.jsxs)("svg",{width:"24",height:"30",viewBox:"0 0 24 30",className:"drop-shadow-md",children:[(0,r.jsx)("rect",{x:"2",y:"2",width:"2",height:"28",rx:"1",fill:{silver:"#cbd5e1",gold:"#eab308",wood:"#854d0e",black:"#262626"}[t.pole]||"#cbd5e1"}),(0,r.jsxs)("g",{transform:"translate(4, 3)",children:[(0,r.jsx)("defs",{children:(0,r.jsxs)("clipPath",{id:l,children:["rectangle"===t.shape&&(0,r.jsx)("rect",{x:"0",y:"0",width:"20",height:"12"}),"pennant"===t.shape&&(0,r.jsx)("polygon",{points:"0,0 20,6 0,12"}),"triangle"===t.shape&&(0,r.jsx)("polygon",{points:"0,0 20,0 10,12 0,0"}),"swallowtail"===t.shape&&(0,r.jsx)("polygon",{points:"0,0 20,0 20,12 10,6 0,12"})]})}),(0,r.jsxs)("g",{clipPath:"url(#".concat(l,")"),children:["solid"===t.pattern&&(0,r.jsx)("rect",{x:"0",y:"0",width:"20",height:"12",fill:i}),"stripe-h"===t.pattern&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("rect",{x:"0",y:"0",width:"20",height:"12",fill:i}),(0,r.jsx)("rect",{x:"0",y:"6",width:"20",height:"6",fill:s})]}),"stripe-v"===t.pattern&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("rect",{x:"0",y:"0",width:"20",height:"12",fill:i}),(0,r.jsx)("rect",{x:"10",y:"0",width:"10",height:"12",fill:s})]}),"cross"===t.pattern&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("rect",{x:"0",y:"0",width:"20",height:"12",fill:i}),(0,r.jsx)("rect",{x:"8",y:"0",width:"4",height:"12",fill:s}),(0,r.jsx)("rect",{x:"0",y:"4",width:"20",height:"4",fill:s})]}),"circle"===t.pattern&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("rect",{x:"0",y:"0",width:"20",height:"12",fill:i}),(0,r.jsx)("circle",{cx:"10",cy:"6",r:"4",fill:s})]}),"checkered"===t.pattern&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("rect",{x:"0",y:"0",width:"10",height:"6",fill:i}),(0,r.jsx)("rect",{x:"10",y:"0",width:"10",height:"6",fill:s}),(0,r.jsx)("rect",{x:"0",y:"6",width:"10",height:"6",fill:s}),(0,r.jsx)("rect",{x:"10",y:"6",width:"10",height:"6",fill:i})]})]})]})]})};function A(){var e;let{userData:t}=(0,N.useAuth)(),[a,_]=(0,i.useState)(null),[E,P]=(0,i.useState)([]),[A,H]=(0,i.useState)(.25),[X,T]=(0,i.useState)(!0),[L,F]=(0,i.useState)(!1),[U,O]=(0,i.useState)(!0),[Z,G]=(0,i.useState)(!1),[J,B]=(0,i.useState)(Date.now()),[q,K]=(0,i.useState)(R),Y=(0,i.useRef)(R),[V,W]=(0,i.useState)([]),[Q,$]=(0,i.useState)(null),[ee,et]=(0,i.useState)(!1),[ea,er]=(0,i.useState)(!1),[ei,es]=(0,i.useState)(null),[el,en]=(0,i.useState)(null),[eo,ec]=(0,i.useState)(null),[ed,eu]=(0,i.useState)(!1),[ex,eh]=(0,i.useState)(!1),[em,ep]=(0,i.useState)("");(0,i.useEffect)(()=>{if(!t)return;let e="student"===t.role?t.teacherId:t.uid;if(!e)return;let a=(0,k.cf)((0,k.JU)(S.db,"users/".concat(e,"/settings"),"classBonus"),e=>{e.exists()&&ec(e.data())});return"teacher"===t.role?ep(t.schoolName||""):(0,k.QT)((0,k.JU)(S.db,"users",e)).then(e=>{e.exists()&&ep(e.data().schoolName||"")}),()=>a()},[t]),(0,i.useEffect)(()=>{eo&&eo.current>=eo.target&&!ex?eu(!0):eu(!1)},[eo,ex]),(0,i.useEffect)(()=>{if(!t)return;let e="student"===t.role?t.teacherId:t.uid;if(!e)return;let a=(0,k.cf)((0,k.JU)(S.db,"game-config","asteroidEvent_".concat(e)),e=>{e.exists()?en(e.data()):en(null)});return()=>a()},[t]);let[eb,eg]=(0,i.useState)(!0),ef=()=>{let e=!eb;if(eg(e),e){let e=document.getElementById("map-notification-audio");e&&(e.volume=0,e.play().then(()=>{e.pause(),e.currentTime=0,e.volume=.5}).catch(e=>console.error("Audio unlock failed",e)))}},ev=(0,i.useRef)(eb);(0,i.useEffect)(()=>{ev.current=eb},[eb]);let[ew,ey]=(0,i.useState)(new Set),[ej,eN]=(0,i.useState)([]),ek=(0,i.useRef)(new Map),eS=(0,i.useRef)(!0),ez=(0,i.useCallback)(()=>et(!1),[]),e_=(0,i.useRef)({x:0,y:0});(0,i.useEffect)(()=>{Y.current=q},[q]),(0,i.useEffect)(()=>{if(!t)return;let e="student"===t.role?t.teacherId:t.uid;if(!e&&"admin"!==t.role)return;let a=(0,k.JU)(S.db,"users/".concat(e,"/settings"),"ranks"),r=(0,k.cf)(a,async e=>{if(e.exists()&&e.data().list)K(e.data().list);else{let e=(0,k.JU)(S.db,"game-config","ranks"),t=await (0,k.QT)(e);t.exists()&&t.data().list&&K(t.data().list)}});return()=>r()},[t]),(0,i.useEffect)(()=>{if(!t)return;let e="student"===t.role?t.teacherId:t.uid;if(!e)return;let a=(0,k.IO)((0,k.hJ)(S.db,"users/".concat(e,"/behaviors")),(0,k.Xo)("xp","desc")),r=(0,k.cf)(a,e=>{eN(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>r()},[t]);let eC=(0,i.useRef)(A);(0,i.useRef)(null),(0,i.useEffect)(()=>{eC.current=A},[A]),(0,i.useEffect)(()=>{if(!X)return;let e=()=>{let e=(M.H.reduce((e,t)=>Math.max(e,t.orbitSize),0)||4400)+200,t=Math.min(window.innerWidth/e,window.innerHeight/e);H(t=Math.min(Math.max(t,.05),1.5))};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[X]),(0,i.useEffect)(()=>{let e;G(!0);let t=0,a=r=>{let i=r-t;i>33.333333333333336&&(B(Date.now()),t=r-i%33.333333333333336),e=requestAnimationFrame(a)};return!U||ee||V.length||(e=requestAnimationFrame(a)),()=>cancelAnimationFrame(e)},[U,ee,V.length]);let[eE,eP]=(0,i.useState)({x:0,y:0}),[eI,eM]=(0,i.useState)(!1),eR=(0,i.useRef)({x:0,y:0}),eD=(0,i.useRef)(new Set);(0,i.useEffect)(()=>{e_.current=eE},[eE]);let eA=(0,i.useRef)(0),eH=(0,i.useRef)();(0,i.useEffect)(()=>(V.length>eA.current&&(eH.current&&clearTimeout(eH.current),eH.current=setTimeout(()=>{W([])},15e3)),eA.current=V.length,()=>{eH.current&&clearTimeout(eH.current)}),[V]),(0,i.useEffect)(()=>{if(!t)return;let e="student"===t.role?t.teacherId:t.uid;if(!e&&"admin"!==t.role)return;let a=(0,k.IO)((0,k.hJ)(S.db,"users"),(0,k.ar)("teacherId","==",e));a="teacher"===t.role?(0,k.IO)((0,k.hJ)(S.db,"users"),(0,k.ar)("teacherId","==",t.uid)):"student"===t.role&&t.teacherId?(0,k.IO)((0,k.hJ)(S.db,"users"),(0,k.ar)("teacherId","==",t.teacherId)):(0,k.IO)((0,k.hJ)(S.db,"users"));let r=(0,k.cf)(a,{next:e=>{let t=[];e.forEach(e=>{var a,r;let i=e.data(),s=i.location||"earth",l={id:e.id,cadetName:(null===(a=i.spaceship)||void 0===a?void 0:a.name)||i.displayName||"Unknown Traveler",locationId:s,status:i.travelStatus||"idle",destinationId:i.destinationId,travelStart:i.travelStart,travelEnd:i.travelEnd,avatarColor:(null===(r=i.spaceship)||void 0===r?void 0:r.color)||"text-cyan-400",avatar:i.avatar,role:i.role,xp:i.xp||0,lastXpReason:i.lastXpReason,flag:i.flag,visitedPlanets:i.visitedPlanets||[]};t.push(l)}),P(t),t.forEach(e=>{if(!eS.current){let t=ek.current.get(e.id);if(void 0!==t&&e.xp>t){let a=M.H.find(t=>t.id===e.locationId);if(a){let e=1e3*a.orbitDuration;a.startAngle,e>0&&(Date.now(),a.orbitDuration,a.orbitDuration),a.orbitSize}let r=Y.current.slice().sort((e,t)=>t.minXP-e.minXP).find(e=>t>=e.minXP),i=Y.current.slice().sort((e,t)=>t.minXP-e.minXP).find(t=>e.xp>=t.minXP),s=i&&r&&i.minXP>r.minXP,l={id:Math.random().toString(),ship:e,xpGained:e.xp-t,newRank:s?i.name:void 0,startPos:{x:window.innerWidth/2,y:window.innerHeight/2},reason:e.lastXpReason},n=document.getElementById("map-notification-audio");n&&ev.current&&(console.log("Map: Playing Award Sound"),n.currentTime=0,n.volume=.5,n.play().catch(e=>console.error("Map audio playback failed (Autoplay blocked? Click map to enable):",e))),W(e=>[...e,l])}}ek.current.set(e.id,e.xp)}),eS.current=!1},error:e=>console.log("Silent Permission Error",e)});return()=>r()},[t]);let[eX,eT]=(0,i.useState)(new Map);(0,i.useEffect)(()=>{if(!t)return;let e="student"===t.role?t.teacherId:t.uid;if(!e)return;let a=(0,k.hJ)(S.db,"users/".concat(e,"/planets")),r=(0,k.cf)(a,e=>{let t=new Map;e.forEach(e=>{let a=e.data();a.id&&t.set(a.id,a)}),eT(t)});return()=>r()},[t]);let eL=(e,t)=>{let a=M.H.find(t=>t.id===e);if(!a||0===a.orbitSize)return{x:0,y:0};let r=1e3*a.orbitDuration,i=a.startAngle;r>0&&(i+=t/1e3%a.orbitDuration/a.orbitDuration*360);let s=Math.PI/180*i,l=a.orbitSize/2;return{x:l*Math.sin(s),y:-l*Math.cos(s)}},eF=e=>{if(e<60)return"".concat(Math.round(e)," mins");let t=Math.floor(e/60);return t<24?"".concat(t,"h ").concat(Math.round(e%60),"m"):"".concat(Math.floor(t/24),"d ").concat(t%24,"h")},eU=async e=>{var r;if(!a||!t)return;let i=e||t.uid,s=!!e,l=E.find(e=>e.id===i);if(!l&&s){alert("Target signal lost. Cannot command.");return}let n=(null==l?void 0:l.locationId)||(s?"earth":t.location||"earth");if(n===a.id&&!s){alert("You are already here!");return}let o=M.H.find(e=>e.id===n);if(!o){console.error("Unknown start planet");return}let c=Math.abs(a.orbitSize-o.orbitSize)/2,d=Math.max(5.376*c/(1+1.2*((null===(r=t.upgrades)||void 0===r?void 0:r.boosters)||0)),1);if(void 0!==t.fuel&&t.fuel,s){if(!confirm("Command ".concat(null==l?void 0:l.cadetName," to travel to ").concat(a.name,"?\nDuration: ").concat(eF(d))))return}else{let e="Plotting course to ".concat(a.name,"...\n\n")+"Distance: ".concat(Math.round(c)," AU\n")+"Estimated Time: ".concat(eF(d),"\n")+"Engage Hyperdrive?";if(!confirm(e))return}let u=6e4*d;try{let e=(0,k.JU)(S.db,"users",i),t={travelStatus:"traveling",location:n,destinationId:a.id,travelStart:Date.now(),travelEnd:Date.now()+u};await (0,k.r7)(e,t),s||_(null),s&&alert("Command Sent: ".concat(null==l?void 0:l.cadetName," en route to ").concat(a.name))}catch(e){console.error("Initiating travel failed:",e),alert("Navigational Computer Error. Try again.")}};(0,i.useEffect)(()=>{if(!t)return;let e="teacher"===t.role||"admin"===t.role||"mr@shootyq.com"===t.email;E.forEach(a=>{let r=a.id===t.uid||e;"traveling"!==a.status&&eD.current.has(a.id)&&eD.current.delete(a.id),r&&"traveling"===a.status&&a.travelEnd&&J>a.travelEnd&&!eD.current.has(a.id)&&(eD.current.add(a.id),(async()=>{try{let e=(0,k.JU)(S.db,"users",a.id);await (0,k.r7)(e,{travelStatus:"idle",location:a.destinationId||"earth",destinationId:null,travelStart:null,travelEnd:null})}catch(e){console.error("Landing failed for ".concat(a.cadetName,":"),e),eD.current.delete(a.id)}})())})},[J,E,t]),(0,i.useEffect)(()=>{t&&!t.location&&(async()=>{try{let e=(0,k.JU)(S.db,"users",t.uid);await (0,k.r7)(e,{location:"earth"})}catch(e){console.error("Auto-positioning failed",e)}})()},[t]),(0,i.useEffect)(()=>{L&&a&&t&&(async()=>{let e=(0,k.JU)(S.db,"users",t.uid);await (0,k.r7)(e,{visitedPlanets:(0,k.vr)(a.id)})})()},[L,a,t]);let eO=(()=>{if(!el||!el.active)return null;if(0===E.length)return{progress:0,timeLeft:0,totalXP:0,gained:0};let e=E.reduce((e,t)=>e+(t.xp||0),0),t=Math.max(0,e-(el.startClassXP||0)),a=Math.min(100,t/(el.targetXP||1)*100),r=(Date.now()-el.startTime)/1e3;return{progress:a,timeLeft:Math.max(0,el.duration-r),gained:t,totalXP:e}})(),eZ=eO&&eO.gained>=el.targetXP,eG=eO&&eO.timeLeft<=0&&!eZ;(0,i.useEffect)(()=>{if(eZ&&(null==el?void 0:el.active)&&(null==t?void 0:t.role)==="teacher"){let e=setTimeout(async()=>{try{let e="asteroidEvent_".concat(t.uid),a=(0,k.JU)(S.db,"game-config",e);await (0,k.r7)(a,{active:!1,status:"success"})}catch(e){console.error("Failed to auto-close asteroid event",e)}},5e3);return()=>clearTimeout(e)}},[eZ,null==el?void 0:el.active,t]);let eJ=()=>{eM(!1)},[eB,eq]=(0,i.useState)([]);return(0,i.useEffect)(()=>{eq(Array.from({length:100},(e,t)=>({id:t,top:"".concat(100*Math.random(),"%"),left:"".concat(100*Math.random(),"%"),size:Math.random()>.8?"h-1 w-1":"h-0.5 w-0.5",opacity:.2+.5*Math.random(),animationDuration:"".concat(3*Math.random()+2,"s")})))},[]),(0,r.jsxs)("div",{className:"relative w-full h-full overflow-hidden bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-slate-900 via-[#00091d] to-black flex items-center justify-center ".concat(eI?"cursor-grabbing":"cursor-grab"),onWheel:e=>{T(!1),H(Math.min(Math.max(.05,A-.001*e.deltaY),2))},onMouseDown:e=>{T(!1),eM(!0),eR.current={x:e.clientX,y:e.clientY}},onMouseMove:e=>{if(!eI)return;let t=e.clientX-eR.current.x,a=e.clientY-eR.current.y;eP(e=>({x:e.x+t,y:e.y+a})),eR.current={x:e.clientX,y:e.clientY}},onMouseUp:eJ,onMouseLeave:eJ,children:[(0,r.jsx)("audio",{id:"map-notification-audio",src:(0,z.K)("/sounds/notification.m4a?v=2"),preload:"auto"}),(0,r.jsxs)("div",{className:"absolute top-6 left-6 z-40 pointer-events-none",children:[(0,r.jsx)("div",{className:"text-white/50 text-[10px] uppercase tracking-[0.2em] font-bold mb-1",children:"Sector Control"}),(0,r.jsx)("div",{className:"text-xl md:text-3xl font-black text-white uppercase tracking-widest drop-shadow-[0_0_10px_rgba(6,182,212,0.5)]",children:em||"Deep Space Network"})]}),(0,r.jsx)("button",{onClick:e=>{e.stopPropagation(),ef()},className:"absolute top-6 right-6 z-50 p-3 rounded-full border backdrop-blur-md transition-all ".concat(eb?"bg-cyan-500/20 border-cyan-400 text-cyan-400 shadow-[0_0_15px_rgba(34,211,238,0.3)]":"bg-black/20 border-white/10 text-white/30 hover:bg-white/10 hover:text-white"),children:eb?(0,r.jsx)(n.Z,{size:24}):(0,r.jsx)(o.Z,{size:24})}),(0,r.jsx)("div",{className:"absolute inset-0 pointer-events-none",children:eB.map(e=>(0,r.jsx)("div",{className:"absolute bg-white rounded-full ".concat(e.size," animate-pulse"),style:{top:e.top,left:e.left,opacity:e.opacity,animationDuration:e.animationDuration}},e.id))}),(0,r.jsxs)("div",{className:"relative flex items-center justify-center transition-transform duration-75 ease-linear will-change-transform",style:{transform:"translate(".concat(eE.x,"px, ").concat(eE.y,"px) scale(").concat(A,")")},children:[E.map(e=>{if("traveling"!==e.status||!e.destinationId||!e.travelStart||!e.travelEnd)return null;let t=eL(e.locationId,J),a=eL(e.destinationId,J),i=e.travelEnd-e.travelStart,s=Math.min(Math.max((J-e.travelStart)/i,0),1);if(s>=1||s<=0)return null;let l=t.x+(a.x-t.x)*s,n=t.y+(a.y-t.y)*s,o=a.x-t.x,d=a.y-t.y,u=180*Math.atan2(d,o)/Math.PI+45;return(0,r.jsxs)("div",{className:"absolute z-10 flex flex-col items-center justify-center transition-opacity",style:{transform:"translate(".concat(l,"px, ").concat(n,"px)")},children:[(0,r.jsx)("div",{className:"absolute top-1/2 left-1/2 h-0.5 bg-dashed from-transparent to-cyan-500/50 origin-left opacity-30 pointer-events-none",style:{width:Math.sqrt(o*o+d*d)*(1-s),transform:"rotate(".concat(Math.atan2(d,o),"rad)")}}),(0,r.jsxs)("div",{className:"relative",children:["teacher"===e.role?(0,r.jsx)(c.Z,{size:24,className:"text-yellow-400 drop-shadow-[0_0_15px_rgba(234,179,8,0.8)]",style:{transform:"rotate(".concat(u,"deg)")}}):(0,r.jsx)("div",{className:"relative w-12 h-12 flex items-center justify-center",style:{transform:"rotate(".concat(u+45,"deg)")},children:(0,r.jsxs)("div",{className:"relative w-full h-full",children:[(0,r.jsx)("img",{src:(0,z.K)("/images/ships/finalship.png"),alt:"Traveling Ship",className:"w-full h-full object-contain drop-shadow-[0_0_8px_rgba(255,255,255,0.9)] relative z-20"}),(0,r.jsx)("div",{className:"absolute top-[22%] left-[26%] w-[48%] h-[30%] z-30 rounded-full overflow-hidden bg-cyan-900/20",children:(0,r.jsx)(C.Yt,{userData:e,className:"w-full h-full scale-[1.35] translate-y-1"})})]})}),(0,r.jsxs)("span",{className:"absolute top-full left-1/2 -translate-x-1/2 text-[8px] bg-black/50 text-white px-1 rounded whitespace-nowrap mt-1",children:[e.cadetName," (",Math.round(100*s),"%)"]})]})]},"travel-".concat(e.id))}),M.H.map(e=>(0,r.jsxs)(i.Fragment,{children:["sun"!==e.id&&(0,r.jsx)("div",{className:"absolute rounded-full border border-white/10 pointer-events-none",style:{width:e.orbitSize,height:e.orbitSize,zIndex:0}}),(0,r.jsx)("div",{className:"absolute flex items-center justify-center pointer-events-none",style:{width:e.orbitSize||1,height:e.orbitSize||1,transform:U&&e.orbitDuration>0?"rotate(".concat(J/1e3%e.orbitDuration/e.orbitDuration*360+e.startAngle,"deg)"):"rotate(".concat(e.startAngle,"deg)")},children:(0,r.jsxs)("div",{className:"relative cursor-pointer group pointer-events-auto",style:{transform:"translateY(-".concat(e.orbitSize/2,"px) rotate(").concat(U&&e.orbitDuration>0?-(J/1e3%e.orbitDuration/e.orbitDuration*360+e.startAngle):-e.startAngle,"deg)")},onClick:t=>{t.stopPropagation(),_(e)},children:[(0,r.jsxs)("div",{className:"rounded-full ".concat(e.size," ").concat(["sun","mercury","venus","earth","mars","jupiter","saturn","uranus","neptune"].includes(e.id)?"":e.color," shadow-lg transition-transform group-hover:scale-125 z-20 relative ring-0 group-hover:ring-4 ring-white/20 flex items-center justify-center"),children:[["sun","mercury","venus","earth","mars","jupiter","saturn","uranus","neptune"].includes(e.id)?(0,r.jsx)("img",{src:(0,z.K)("/images/planetpng/".concat(e.id,".png")),alt:e.name,className:"w-[140%] h-[140%] max-w-none object-contain drop-shadow-2xl"}):null,E.some(t=>{var a;return null===(a=t.visitedPlanets)||void 0===a?void 0:a.includes(e.id)})&&(0,r.jsxs)("div",{className:"absolute -top-2 left-1/2 -translate-x-1/2 flex items-end justify-center gap-0.5 h-4 opacity-70 group-hover:opacity-100 transition-opacity",children:[E.filter(t=>{var a;return null===(a=t.visitedPlanets)||void 0===a?void 0:a.includes(e.id)}).slice(0,3).map((e,t)=>{var a;return(0,r.jsx)("div",{className:"w-0.5 h-2 ".concat((null===(a=e.avatarColor)||void 0===a?void 0:a.replace("text","bg").replace("400","500"))||"bg-white"," rounded-t-full shadow-[0_0_5px_rgba(255,255,255,0.8)]")},e.id)}),E.filter(t=>{var a;return null===(a=t.visitedPlanets)||void 0===a?void 0:a.includes(e.id)}).length>3&&(0,r.jsx)("div",{className:"w-0.5 h-1 bg-white rounded-full"})]}),(0,r.jsx)("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 text-center pointer-events-none z-50 flex items-center justify-center w-32",children:(0,r.jsx)("div",{children:(0,r.jsx)("span",{className:"text-white/60 text-xs uppercase tracking-widest font-bold group-hover:text-white transition-all shadow-black drop-shadow-md bg-black/50 px-2 py-0.5 rounded-full backdrop-blur-sm border border-white/10",style:{fontSize:A<.3?"".concat(1/A*.5,"rem"):"0.75rem",padding:A<.3?"".concat(1/A*.1,"rem ").concat(1/A*.2,"rem"):"0.125rem 0.5rem"},children:e.name})})})]}),(0,r.jsxs)("div",{className:"absolute top-0 left-0 w-full h-full flex items-center justify-center pointer-events-none",children:[E.filter(t=>t.locationId===e.id&&"traveling"!==t.status).length>0&&(0,r.jsx)("div",{className:"absolute rounded-full border border-cyan-500/30 border-dashed animate-[spin_60s_linear_infinite]",style:{width:e.pixelSize+80,height:e.pixelSize+80}}),E.filter(t=>t.locationId===e.id&&"traveling"!==t.status).map((t,a,i)=>{let s=J/1e3*15,l=360/Math.max(i.length,1)*a-90+s,n=e.pixelSize/2+40;return(0,r.jsxs)("div",{className:"absolute flex flex-col items-center justify-center",style:{transform:"rotate(".concat(l,"deg) translate(").concat(n,"px) rotate(").concat(-l,"deg)"),zIndex:30},children:[(0,r.jsx)("span",{className:"text-[10px] font-bold text-white bg-black/70 px-2 rounded border border-cyan-500/30 whitespace-nowrap mb-1 shadow-lg backdrop-blur-sm",children:t.cadetName}),"teacher"===t.role?(0,r.jsx)(c.Z,{size:24,className:"text-yellow-400 drop-shadow-[0_0_15px_rgba(234,179,8,0.8)]",style:{transform:"rotate(0deg)"}}):(0,r.jsx)("div",{className:"relative w-12 h-12 flex items-center justify-center -mb-2",style:{transform:"rotate(-45deg)"},children:(0,r.jsxs)("div",{className:"relative w-full h-full",children:[(0,r.jsx)("img",{src:(0,z.K)("/images/ships/finalship.png"),alt:"Docked Ship",className:"w-full h-full object-contain drop-shadow-[0_0_8px_rgba(255,255,255,0.8)] relative z-20"}),(0,r.jsx)("div",{className:"absolute top-[22%] left-[26%] w-[48%] h-[30%] z-30 rounded-full overflow-hidden bg-cyan-900/20",children:(0,r.jsx)(C.Yt,{userData:t,className:"w-full h-full scale-[1.35] translate-y-1"})})]})})]},t.id)})]})]})})]},e.id))]}),(0,r.jsxs)("div",{className:"absolute bottom-6 right-6 flex flex-col gap-2 z-[60]",children:[((null==t?void 0:t.role)==="teacher"||(null==t?void 0:t.email)==="andrewpcarlson85@gmail.com")&&(0,r.jsx)("div",{id:"map-btn-command",children:(0,r.jsx)("button",{onClick:()=>er(!ea),className:"p-3 rounded-lg border backdrop-blur transition-colors flex items-center justify-center ".concat(ea?"bg-orange-600 text-white border-orange-500 animate-pulse":"bg-black/50 border-white/20 text-orange-400 hover:bg-white/10"),title:"Fleet Command Override",children:(0,r.jsx)(d.Z,{size:24})})}),(null==t?void 0:t.role)==="teacher"&&(0,r.jsx)("div",{id:"map-btn-grid",children:(0,r.jsx)("button",{onClick:()=>et(!ee),className:"p-3 rounded-lg border backdrop-blur transition-colors flex items-center justify-center ".concat(ee?"bg-cyan-500 text-white border-cyan-400":"bg-black/50 border-white/20 text-cyan-400 hover:bg-white/10"),title:"Class Manifest",children:(0,r.jsx)(u.Z,{size:24})})}),(0,r.jsxs)("div",{className:"bg-black/50 backdrop-blur border border-white/20 rounded-lg p-2 flex flex-col gap-2",children:[(0,r.jsx)("button",{onClick:()=>{T(!1),H(e=>Math.min(e+.1,2))},className:"p-2 hover:bg-white/10 rounded text-white",title:"Zoom In",children:(0,r.jsx)(x.Z,{})}),(0,r.jsx)("button",{onClick:()=>{T(!1),H(e=>Math.max(e-.1,.05))},className:"p-2 hover:bg-white/10 rounded text-white",title:"Zoom Out",children:(0,r.jsx)(h.Z,{})}),(0,r.jsx)("div",{className:"w-full h-px bg-white/20 my-1"}),(0,r.jsx)("button",{onClick:()=>{eP({x:0,y:0}),T(!0)},className:"p-2 hover:bg-white/10 rounded text-white",title:"Reset View",children:(0,r.jsx)(m.Z,{size:20})})]}),(0,r.jsx)("button",{onClick:()=>O(!U),className:"p-3 rounded-lg border backdrop-blur transition-colors flex items-center justify-center ".concat(U?"bg-blue-500/20 border-blue-400 text-blue-300":"bg-black/50 border-white/20 text-gray-400"),title:"Toggle Orbits",children:U?(0,r.jsx)(p.Z,{size:20}):(0,r.jsx)(b.Z,{size:20})})]}),eo&&(0,r.jsxs)("div",{className:"absolute top-6 right-6 z-40 bg-black/60 backdrop-blur border border-cyan-500/30 rounded-xl p-4 w-64 shadow-[0_0_20px_rgba(6,182,212,0.2)]",children:[(0,r.jsx)("div",{className:"flex items-center justify-between mb-2 text-cyan-300",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(g.Z,{size:16,className:"text-yellow-400"}),(0,r.jsx)("span",{className:"text-xs font-bold uppercase tracking-wider",children:"Class Bonus"})]})}),(0,r.jsxs)("div",{className:"w-full bg-gray-900 rounded-full h-3 mb-2 border border-cyan-500/20 relative overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-yellow-400/10 animate-pulse"}),(0,r.jsx)("div",{className:"bg-gradient-to-r from-yellow-600 to-yellow-400 h-full rounded-full transition-all duration-1000 shadow-[0_0_10px_rgba(250,204,21,0.5)]",style:{width:"".concat(Math.min(eo.current/eo.target*100,100),"%")}})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center bg-black/40 p-1.5 rounded",children:[(0,r.jsxs)("span",{className:"text-[10px] text-yellow-400 font-bold",children:[eo.current.toLocaleString()," / ",eo.target.toLocaleString()]}),(0,r.jsx)("span",{className:"text-[10px] text-cyan-400 truncate max-w-[100px]",children:eo.reward})]})]}),(0,r.jsx)(s.M,{children:a&&(0,r.jsxs)(l.E.div,{initial:{opacity:0,x:300},animate:{opacity:1,x:0},exit:{opacity:0,x:300},className:"absolute right-0 top-0 bottom-0 w-80 bg-black/90 backdrop-blur-xl border-l border-white/10 p-6 z-[70] flex flex-col",children:[ea&&ei&&(0,r.jsxs)("div",{className:"bg-orange-500/20 border border-orange-500/50 p-2 rounded mb-4 text-center",children:[(0,r.jsx)("p",{className:"text-orange-400 text-xs font-bold uppercase tracking-widest",children:"RELAYING COMMAND TO"}),(0,r.jsx)("p",{className:"text-white font-bold",children:(null===(e=E.find(e=>e.id===ei))||void 0===e?void 0:e.cadetName)||"Unknown Unit"})]}),(0,r.jsxs)("div",{className:"flex justify-between items-start mb-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-3xl font-bold text-white",children:a.name}),(0,r.jsxs)("p",{className:"text-blue-300 text-sm",children:["Sector ",a.id.toUpperCase()]})]}),(0,r.jsx)("button",{onClick:()=>_(null),className:"text-gray-400 hover:text-white",children:"✕"})]}),(0,r.jsxs)("div",{className:"w-full h-40 rounded-lg mb-6 bg-black/40 border border-white/10 flex items-center justify-center overflow-hidden relative group",children:[(0,r.jsx)("div",{className:"absolute inset-0 opacity-30 ".concat(a.color," blur-xl")}),(0,r.jsx)("img",{src:(0,z.K)("/images/planetpng/".concat(a.id,".png")),className:"w-32 h-32 object-contain relative z-10 drop-shadow-2xl",alt:a.name})]}),(0,r.jsx)("p",{className:"text-gray-300 mb-6",children:a.description}),(()=>{let e=eX.get(a.id),t=(null==e?void 0:e.currentXP)||0,i=(null==e?void 0:e.xpGoal)||1e3,s=Math.min(t/i*100,100);return(0,r.jsxs)("div",{className:"mb-6 p-4 bg-cyan-950/20 rounded-lg border border-cyan-900/50",children:[(0,r.jsxs)("div",{className:"text-xs uppercase tracking-widest text-cyan-500 mb-2 flex justify-between",children:[(0,r.jsx)("span",{children:"Colony Progress"}),(0,r.jsxs)("span",{className:"text-white font-bold",children:[Math.round(s),"%"]})]}),(0,r.jsx)("div",{className:"h-2 bg-black/50 rounded-full overflow-hidden border border-white/10 mb-2",children:(0,r.jsx)(l.E.div,{initial:{width:0},animate:{width:"".concat(s,"%")},className:"h-full bg-cyan-500"})}),(0,r.jsxs)("div",{className:"text-[10px] text-gray-400 text-right mb-4",children:[t," / ",i," XP"]}),(null==e?void 0:e.rewardName)&&(0,r.jsxs)("div",{className:"border-t border-cyan-800/30 pt-3",children:[(0,r.jsxs)("div",{className:"text-[10px] text-yellow-500 uppercase tracking-widest font-bold mb-1 flex items-center gap-1",children:[(0,r.jsx)(f.Z,{size:12})," Target Reward"]}),(0,r.jsx)("div",{className:"text-white font-bold text-sm",children:e.rewardName}),e.rewardDescription&&(0,r.jsx)("div",{className:"text-gray-400 text-xs italic mt-1",children:e.rewardDescription})]})]})})(),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("div",{className:"text-xs uppercase tracking-widest text-gray-500 mb-2",children:"Travel Requirements"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-yellow-400",children:[(0,r.jsx)("span",{className:"font-bold text-xl",children:a.xpRequired}),(0,r.jsx)("span",{className:"text-sm",children:"XP Clearance"})]})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[(0,r.jsx)("div",{className:"text-xs uppercase tracking-widest text-gray-500 mb-2",children:"Ships in Orbit"}),(0,r.jsx)("div",{className:"space-y-2",children:0===E.filter(e=>e.locationId===a.id).length?(0,r.jsx)("p",{className:"text-gray-600 italic",children:"No ships currently in sector."}):E.filter(e=>e.locationId===a.id).map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-3 p-2 rounded bg-white/5 border border-white/5",children:[(0,r.jsx)(v.Z,{size:16,className:e.avatarColor}),(0,r.jsx)("span",{className:"text-gray-200",children:e.cadetName})]},e.id))}),(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("div",{className:"text-xs uppercase tracking-widest text-gray-500 mb-2",children:"Colony Flags Planted"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:0===E.filter(e=>{var t;return null===(t=e.visitedPlanets)||void 0===t?void 0:t.includes(a.id)}).length?(0,r.jsx)("p",{className:"text-gray-600 italic text-xs",children:"No landings recorded."}):E.filter(e=>{var t;return null===(t=e.visitedPlanets)||void 0===t?void 0:t.includes(a.id)}).map(e=>(0,r.jsx)("div",{title:"".concat(e.cadetName," was here"),className:"relative group/flag",children:e.flag?(0,r.jsx)("div",{className:"scale-75",children:(0,r.jsx)(D,{config:e.flag})}):(0,r.jsx)("div",{className:"w-4 h-6 ".concat(e.avatarColor.replace("text","bg")," rounded-sm opacity-50")})},e.id))})]})]}),ea&&ei?(0,r.jsxs)("button",{onClick:()=>eU(ei),className:"mt-4 w-full py-3 bg-orange-600 hover:bg-orange-500 text-white rounded font-bold flex items-center justify-center gap-2 transition-colors border border-orange-400 shadow-[0_0_20px_rgba(249,115,22,0.3)] animate-pulse",children:[(0,r.jsx)(w.Z,{size:18}),"EXECUTE REMOTE JUMP"]}):(null==t?void 0:t.location)===a.id?(0,r.jsxs)("button",{onClick:()=>{F(!0)},className:"mt-4 w-full py-3 bg-green-600 hover:bg-green-500 text-white rounded font-bold flex items-center justify-center gap-2 transition-colors border border-green-400 shadow-[0_0_20px_rgba(34,197,94,0.3)] animate-pulse",children:[(0,r.jsx)(y.Z,{size:18}),"LAND ON SURFACE"]}):(0,r.jsxs)("button",{onClick:()=>eU(),className:"mt-4 w-full py-3 bg-cyan-600 hover:bg-cyan-500 text-white rounded font-bold flex items-center justify-center gap-2 transition-colors",children:[(0,r.jsx)(j.Z,{size:18}),"ENGAGE HYPERDRIVE"]})]})}),(0,r.jsx)(s.M,{children:ea&&(0,r.jsxs)(l.E.div,{initial:{x:-300,opacity:0},animate:{x:0,opacity:1},exit:{x:-300,opacity:0},className:"absolute top-0 left-0 bottom-0 w-72 bg-black/90 backdrop-blur-xl border-r border-orange-500/30 z-50 flex flex-col pointer-events-auto",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-orange-500/30 bg-orange-900/10",children:[(0,r.jsxs)("h2",{className:"text-orange-500 font-bold uppercase tracking-widest flex items-center gap-2",children:[(0,r.jsx)(d.Z,{size:20})," Fleet Command"]}),(0,r.jsx)("p",{className:"text-white/30 text-xs mt-1",children:"Remote Navigation Link Active"})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:E.filter(e=>"teacher"!==e.role).sort((e,t)=>e.cadetName.localeCompare(t.cadetName)).map(e=>{var t;return(0,r.jsxs)("div",{onClick:()=>es(ei===e.id?null:e.id),className:"p-3 rounded-lg border cursor-pointer transition-all flex items-center gap-3 relative overflow-hidden ".concat(ei===e.id?"bg-orange-500/20 border-orange-400 text-white":"bg-white/5 border-white/10 text-gray-400 hover:bg-white/10"),children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full border border-white/10 flex items-center justify-center bg-black/50",children:(0,r.jsx)(v.Z,{size:16,className:e.avatarColor})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"font-bold text-sm",children:e.cadetName}),(0,r.jsxs)("div",{className:"text-[10px] uppercase tracking-wider opacity-70",children:["AT: ",(null===(t=M.H.find(t=>t.id===e.locationId))||void 0===t?void 0:t.name)||"Deep Space"]})]}),ei===e.id&&(0,r.jsx)("div",{className:"absolute right-2 text-orange-400 animate-pulse",children:(0,r.jsx)(w.Z,{size:16})})]},e.id)})}),(0,r.jsx)("div",{className:"p-4 border-t border-orange-500/30 bg-orange-900/10 text-xs text-center",children:ei?(0,r.jsx)("span",{className:"text-orange-400 font-bold animate-pulse",children:"Select Destination Planet Map →"}):(0,r.jsx)("span",{className:"text-gray-500",children:"Select a unit to override controls."})})]})}),(0,r.jsxs)("div",{className:"absolute bottom-6 left-6 p-4 bg-black/60 rounded-xl border border-white/10 backdrop-blur text-xs text-gray-400 pointer-events-none select-none",children:[(0,r.jsx)("h3",{className:"text-white font-bold mb-2 uppercase tracking-wider",children:"System Command"}),(0,r.jsxs)("p",{children:["Zoom Level: ",Math.round(100*A),"%"]}),(0,r.jsxs)("p",{children:["Orbit Status: ",U?"ACTIVE":"LOCKED"]}),(0,r.jsxs)("p",{children:["Coordinates: ",Math.round(eE.x),", ",Math.round(eE.y)]}),(0,r.jsx)("p",{className:"mt-2 text-blue-400",children:"Scroll to zoom. Drag to pan."})]}),(0,r.jsx)(I,{isVisible:ee,onClose:ez,ships:E,ranks:q,selectedIds:ew,setSelectedIds:ey,behaviors:ej}),(0,r.jsx)(s.M,{children:V.length>0&&(0,r.jsxs)("div",{className:"absolute inset-0 z-[100] flex items-center justify-center pointer-events-auto cursor-pointer",onClick:()=>W([]),children:[(0,r.jsx)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/40 backdrop-blur-[2px]"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-8 items-center justify-center p-12 max-h-screen overflow-y-auto",children:V.map((e,t)=>{var a;return(0,r.jsxs)(l.E.div,{initial:{scale:0,rotate:-10,y:50},animate:{scale:1,rotate:0,y:0},exit:{scale:0,opacity:0},transition:{type:"spring",stiffness:200,damping:20,delay:.1*t},className:"relative z-50 bg-black/90 border border-cyan-500 rounded-3xl p-6 flex flex-col items-center shadow-[0_0_60px_rgba(6,182,212,0.6)] text-center pointer-events-auto overflow-hidden\n                                ".concat(V.length>1?"w-[300px] aspect-auto":"w-[500px] aspect-square p-8","\n                            "),onClick:e=>{},children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_top,_var(--tw-gradient-stops))] from-cyan-900/40 via-transparent to-transparent"}),(0,r.jsx)("h2",{className:"".concat(V.length>1?"text-sm":"text-xl"," text-cyan-300 font-mono tracking-widest mb-4 uppercase relative z-10"),children:"Training Milestone"}),(0,r.jsx)(l.E.div,{animate:{y:[0,-10,0],rotate:[0,-5,5,0]},transition:{repeat:1/0,duration:4,ease:"easeInOut"},className:"relative z-10 ".concat(V.length>1?"mb-2":"mb-6"),children:(0,r.jsxs)("div",{className:"relative ".concat(V.length>1?"w-24 h-24":"w-40 h-40"),children:[(0,r.jsx)("img",{src:(0,z.K)("/images/ships/finalship.png"),alt:"Award Ship",className:"w-full h-full object-contain drop-shadow-[0_0_25px_rgba(255,255,255,0.4)] relative z-20"}),(0,r.jsx)("div",{className:"absolute top-[22%] left-[26%] w-[48%] h-[30%] z-30 rounded-full overflow-hidden ".concat(null===(a=e.ship.avatarColor)||void 0===a?void 0:a.replace("text","bg").replace("400","900"),"/40")})]})}),(0,r.jsx)("div",{className:"".concat(V.length>1?"text-2xl":"text-4xl"," font-bold text-white mb-2 font-sans relative z-10 truncate w-full"),children:e.ship.cadetName}),e.reason&&(0,r.jsxs)("div",{className:"text-cyan-400/80 ".concat(V.length>1?"text-xs":"text-sm"," font-bold uppercase tracking-widest mb-6 relative z-10"),children:["// ",e.reason]}),!e.reason&&(0,r.jsx)("div",{className:"mb-6"}),(0,r.jsxs)("div",{className:"flex items-center justify-center gap-4 w-full relative z-10",children:[(0,r.jsxs)("div",{className:"flex-1 bg-green-500/10 p-3 rounded-xl border border-green-500/30",children:[(0,r.jsx)("span",{className:"block text-green-400 text-[10px] font-bold uppercase tracking-wider mb-1",children:"XP Gained"}),(0,r.jsxs)("span",{className:"block text-2xl font-black text-green-300",children:["+",e.xpGained]})]}),e.newRank&&(0,r.jsxs)(l.E.div,{animate:{scale:[1,1.2,1],rotate:[0,5,-5,0]},transition:{repeat:1/0,duration:1.5},className:"flex-1 bg-gradient-to-br from-yellow-500/20 to-orange-500/20 p-3 rounded-xl border border-yellow-500/50 flex flex-col items-center gap-1 shadow-[0_0_30px_rgba(234,179,8,0.4)] relative overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-yellow-400/10 animate-pulse"}),(0,r.jsx)("span",{className:"block text-yellow-300 text-[10px] font-black uppercase tracking-widest relative z-10",children:"PROMOTION!"}),(()=>{let t=q.find(t=>t.name===e.newRank);return(null==t?void 0:t.image)&&(0,r.jsx)(l.E.img,{initial:{scale:0,rotate:180},animate:{scale:1,rotate:0},transition:{type:"spring",bounce:.6},src:(0,z.K)(t.image),alt:"Rank Badge",className:"w-16 h-16 object-contain my-1 drop-shadow-[0_0_20px_rgba(234,179,8,0.8)] relative z-10"})})(),(0,r.jsx)("span",{className:"block text-sm font-black text-yellow-100 truncate w-full text-center relative z-10",children:e.newRank})]})]})]},e.id)})})]},"award-overlay")}),(0,r.jsx)(s.M,{children:L&&a&&t&&(0,r.jsxs)(l.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-[200] bg-black flex flex-col items-center justify-end overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute inset-0 opacity-50",children:(0,r.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-transparent via-black to-black"})}),(0,r.jsxs)("div",{className:"absolute top-10 left-0 right-0 text-center z-10",children:[(0,r.jsx)(l.E.h1,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},transition:{delay:.5},className:"text-6xl font-black text-white uppercase tracking-widest drop-shadow-[0_0_20px_rgba(255,255,255,0.5)]",children:a.name}),(0,r.jsxs)(l.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"flex items-center justify-center gap-2 mt-4 text-cyan-400 font-mono tracking-widest uppercase bg-black/60 inline-block px-4 py-2 rounded-full border border-cyan-500/30",children:[(0,r.jsx)(y.Z,{size:16}),(0,r.jsx)("span",{children:"Touchdown Confirmed"})]})]}),(0,r.jsx)(l.E.div,{initial:{y:"100%"},animate:{y:"60%"},transition:{duration:1,ease:"circOut"},className:"absolute bottom-0 left-[-50%] right-[-50%] h-[100vh] rounded-[100%] ".concat(a.color," shadow-[0_0_100px_rgba(0,0,0,0.5)] z-0"),style:{filter:"brightness(0.8)"}}),(0,r.jsxs)("div",{className:"relative z-10 mb-20 flex items-end gap-8 pb-32",children:[(0,r.jsx)(l.E.div,{initial:{y:-200,opacity:0,rotate:-20},animate:{y:0,opacity:1,rotate:0},transition:{delay:1.2,type:"spring"},className:"origin-bottom-left",children:(0,r.jsx)("div",{className:"transform scale-[3] drop-shadow-2xl",children:t.flag?(0,r.jsx)(D,{config:t.flag}):(0,r.jsx)("div",{className:"w-4 h-8 bg-gray-400"})})}),(0,r.jsxs)(l.E.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.8,type:"spring"},className:"relative w-48 h-48 -mb-4",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/50 rounded-full blur-xl transform scale-x-150 translate-y-8 opacity-50"}),(0,r.jsx)("div",{className:"relative w-full h-full",children:(0,r.jsx)("div",{className:"w-full h-full relative overflow-visible",children:(0,r.jsx)(C.Yt,{userData:t,className:"w-full h-full"})})})]})]}),(0,r.jsxs)(l.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:2},className:"absolute bottom-10 z-20 flex flex-col gap-4 text-center",children:[(0,r.jsx)("button",{onClick:()=>{F(!1),_(null)},className:"px-8 py-4 bg-white/10 hover:bg-white/20 text-white font-bold rounded-xl border border-white/20 backdrop-blur-md uppercase tracking-widest transition-all hover:scale-105",children:"Return to Orbit"}),(0,r.jsx)("div",{className:"text-white/30 text-xs uppercase tracking-[0.2em] font-mono",children:"Visit Recorded in Logbook"})]}),(0,r.jsxs)(l.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:2.5},className:"absolute top-1/2 right-10 -translate-y-1/2 bg-black/30 backdrop-blur-md p-6 rounded-2xl border border-white/10 max-w-sm hidden lg:block",children:[(0,r.jsx)("h3",{className:"text-white/50 uppercase tracking-widest text-xs font-bold mb-4 border-b border-white/10 pb-2",children:"Previous Explorers"}),(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:E.filter(e=>{var r;return(null===(r=e.visitedPlanets)||void 0===r?void 0:r.includes(a.id))&&e.id!==t.uid}).length>0?E.filter(e=>{var r;return(null===(r=e.visitedPlanets)||void 0===r?void 0:r.includes(a.id))&&e.id!==t.uid}).map(e=>(0,r.jsxs)("div",{className:"relative group cursor-help",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden border border-white/20 bg-black",children:(0,r.jsx)("div",{className:"w-full h-full ".concat(e.avatarColor.replace("text","bg").replace("400","900"))})}),(0,r.jsx)("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 bg-black text-white text-[10px] rounded opacity-0 group-hover:opacity-100 whitespace-nowrap pointer-events-none transition-opacity",children:e.cadetName})]},e.id)):(0,r.jsx)("p",{className:"text-white/30 italic text-sm",children:"You are the first to land here!"})})]})]})}),(0,r.jsx)(s.M,{children:eO&&el&&el.active&&(0,r.jsxs)("div",{className:"absolute inset-0 z-[150] pointer-events-none overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-red-500/10 animate-pulse"}),(0,r.jsxs)("div",{className:"absolute top-8 left-1/2 -translate-x-1/2 bg-red-600/90 text-white p-6 rounded-2xl shadow-[0_0_50px_rgba(220,38,38,0.8)] border-2 border-red-400 backdrop-blur pointer-events-auto min-w-[400px] text-center",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2 mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 text-red-200",children:[(0,r.jsx)("div",{className:"animate-bounce text-2xl",children:"⚠️"}),(0,r.jsx)("h2",{className:"text-lg font-bold uppercase tracking-[0.2em] drop-shadow-md",children:"Asteroid Impact Imminent"}),(0,r.jsx)("div",{className:"animate-bounce text-2xl",children:"⚠️"})]}),(0,r.jsxs)("div",{className:"text-7xl font-black font-mono tracking-widest tabular-nums leading-none my-2 drop-shadow-[0_0_15px_rgba(255,255,255,0.5)]",children:[Math.floor(Math.max(0,eO.timeLeft)/60),":",(Math.floor(Math.max(0,eO.timeLeft))%60).toString().padStart(2,"0")]}),(0,r.jsxs)("div",{className:"text-xs font-mono uppercase tracking-wider opacity-80",children:["Integrity: ",Math.max(0,100-eO.progress).toFixed(1),"%"]})]}),(0,r.jsxs)("div",{className:"w-full h-6 bg-black/50 rounded-full border border-white/20 overflow-hidden relative",children:[(0,r.jsxs)("div",{className:"absolute inset-0 flex items-center justify-center text-[10px] font-bold z-10 uppercase tracking-widest shadow-black drop-shadow-md",children:["Needed: ",el.targetXP-eO.gained," XP"]}),(0,r.jsx)(l.E.div,{className:"h-full bg-gradient-to-r from-red-600 to-red-400",initial:{width:"100%"},animate:{width:"".concat(Math.max(0,100-eO.progress),"%")},transition:{duration:.5}})]})]}),!eZ&&(0,r.jsx)(l.E.div,{initial:{x:"-20vw",y:"20vh",rotate:0},animate:{x:"120vw",y:"60vh",rotate:360},transition:{duration:el.duration,ease:"linear"},className:"absolute top-0 left-0",children:(0,r.jsxs)("div",{className:"w-64 h-64 relative",children:[(0,r.jsxs)("div",{className:"w-full h-full bg-gray-700 rounded-full blur-sm",style:{clipPath:"polygon(20% 0%, 80% 0%, 100% 20%, 100% 80%, 80% 100%, 20% 100%, 0% 80%, 0% 20%)"},children:[(0,r.jsx)("div",{className:"absolute inset-2 bg-gray-600 rounded-full",style:{clipPath:"polygon(92% 0, 100% 25%, 100% 100%, 8% 100%, 0% 25%, 0 0)"}}),(0,r.jsx)("div",{className:"absolute top-1/4 left-1/4 w-8 h-8 bg-black/20 rounded-full blur-sm"}),(0,r.jsx)("div",{className:"absolute bottom-1/3 right-1/4 w-12 h-12 bg-black/30 rounded-full blur-sm"})]}),(0,r.jsx)("div",{className:"absolute top-1/2 left-0 -translate-x-full -translate-y-1/2 w-96 h-32 bg-gradient-to-l from-orange-500/50 to-transparent blur-xl"})]})}),eZ&&(0,r.jsx)(l.E.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},className:"absolute inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm z-[200]",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-8xl font-black text-green-400 uppercase tracking-tighter drop-shadow-[0_0_50px_rgba(74,222,128,0.8)]",children:"Victory!"}),(0,r.jsx)("p",{className:"text-2xl text-white font-mono mt-4 uppercase tracking-widest",children:"Asteroid Destroyed"}),(0,r.jsxs)("div",{className:"mt-8 p-6 bg-green-500/20 rounded-2xl border border-green-500/50 inline-block",children:[(0,r.jsx)("div",{className:"text-xs text-green-300 uppercase font-bold mb-2",children:"Reward Unlocked"}),(0,r.jsx)("div",{className:"text-3xl font-bold text-white",children:el.reward})]})]})}),eG&&(0,r.jsx)(l.E.div,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},className:"absolute inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm z-[200]",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-8xl font-black text-red-600 uppercase tracking-tighter drop-shadow-[0_0_50px_rgba(220,38,38,0.8)]",children:"Impact!"}),(0,r.jsx)("p",{className:"text-2xl text-white font-mono mt-4 uppercase tracking-widest",children:"Shields Failed"}),el.penalty&&(0,r.jsxs)("div",{className:"mt-8 p-6 bg-red-500/20 rounded-2xl border border-red-500/50 inline-block",children:[(0,r.jsx)("div",{className:"text-xs text-red-300 uppercase font-bold mb-2",children:"Systems Critical"}),(0,r.jsx)("div",{className:"text-3xl font-bold text-white",children:el.penalty})]})]})})]})}),(0,r.jsx)(s.M,{children:ed&&eo&&(0,r.jsxs)(l.E.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"absolute inset-0 z-[200] flex items-center justify-center bg-black/90 backdrop-blur-md",children:[(0,r.jsx)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[...Array(20)].map((e,t)=>(0,r.jsx)(l.E.div,{initial:{y:-100,x:"".concat(100*Math.random(),"vw"),opacity:1},animate:{y:"110vh",rotate:360},transition:{duration:2+3*Math.random(),repeat:1/0,ease:"linear"},className:"absolute w-4 h-4 rounded-sm",style:{left:0,backgroundColor:["#fbbf24","#3b82f6","#ef4444","#10b981"][Math.floor(4*Math.random())]}},t))}),(0,r.jsxs)("div",{className:"relative z-10 text-center max-w-4xl p-12 bg-gradient-to-b from-gray-900 via-gray-900 to-black border border-yellow-500/30 rounded-3xl shadow-[0_0_100px_rgba(234,179,8,0.3)]",children:[(0,r.jsx)(l.E.div,{animate:{scale:[1,1.1,1],rotate:[0,5,-5,0]},transition:{duration:2,repeat:1/0},className:"mb-8 inline-block",children:(0,r.jsx)(c.Z,{size:120,className:"text-yellow-400 drop-shadow-[0_0_30px_rgba(234,179,8,0.6)]"})}),(0,r.jsx)("h1",{className:"text-6xl md:text-7xl font-black text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 to-yellow-600 uppercase tracking-tighter mb-4 filter drop-shadow-[0_0_20px_rgba(234,179,8,0.4)]",children:"Goal Achieved!"}),(0,r.jsx)("p",{className:"text-2xl text-yellow-100 font-mono mb-8 tracking-widest uppercase",children:"Class Bonus Unlocked"}),(0,r.jsxs)("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-2xl p-8 mb-10 transform hover:scale-105 transition-transform",children:[(0,r.jsx)("div",{className:"text-sm text-yellow-500 uppercase font-bold tracking-[0.2em] mb-3",children:"Reward Granted"}),(0,r.jsx)("div",{className:"text-4xl md:text-5xl font-bold text-white drop-shadow-md",children:eo.reward})]}),(0,r.jsx)("button",{onClick:()=>eh(!0),className:"px-10 py-4 bg-yellow-500 hover:bg-yellow-400 text-black font-black text-xl uppercase tracking-widest rounded-full shadow-[0_0_30px_rgba(234,179,8,0.4)] hover:shadow-[0_0_50px_rgba(234,179,8,0.6)] transition-all transform hover:-translate-y-1 active:scale-95",children:"Claim Reward"})]})]})})]})}},5802:function(e,t,a){a.d(t,{Cn:function(){return n},Ic:function(){return l},W$:function(){return s},Yt:function(){return o}});var r=a(3827),i=a(1657);let s=[{id:"bunny",name:"Space Bunny",src:"/images/avatar/spacebunny.png"},{id:"cat",name:"Cosmic Cat",src:"/images/avatar/spacecat.png"},{id:"raccoon",name:"Rocket Raccoon",src:"/images/avatar/spaceraccoon.png"},{id:"otter",name:"Orbit Otter",src:"/images/avatar/spaceotter.png"},{id:"pup",name:"Pluto Pup",src:"/images/avatar/spacepup.png"},{id:"hamster",name:"Hyper Hamster",src:"/images/avatar/spacehamster.png"},{id:"owl",name:"Omega Owl",src:"/images/avatar/spaceowl.png"},{id:"penguin",name:"Power Penguin",src:"/images/avatar/spacepenguin.png"},{id:"turtle",name:"Turbo Turtle",src:"/images/avatar/spaceturtle.png"}],l=[{id:"p1",name:"Cadet Blue",config:{hue:0,skinHue:200,bgHue:240,bgSat:60,bgLight:50,activeHat:"none",avatarId:"bunny"}},{id:"p2",name:"Crimson Guard",config:{hue:350,skinHue:0,bgHue:0,bgSat:70,bgLight:40,activeHat:"none",avatarId:"cat"}},{id:"p3",name:"Forest Ranger",config:{hue:120,skinHue:100,bgHue:120,bgSat:50,bgLight:60,activeHat:"none",avatarId:"raccoon"}},{id:"p4",name:"Solar Pilot",config:{hue:45,skinHue:60,bgHue:40,bgSat:90,bgLight:70,activeHat:"none",avatarId:"otter"}},{id:"p5",name:"Void Walker",config:{hue:270,skinHue:260,bgHue:280,bgSat:40,bgLight:20,activeHat:"none",avatarId:"pup"}},{id:"p6",name:"Neon Scout",config:{hue:180,skinHue:300,bgHue:320,bgSat:100,bgLight:50,activeHat:"none",avatarId:"cat"}},{id:"p7",name:"Rusty Mechanic",config:{hue:25,skinHue:30,bgHue:15,bgSat:50,bgLight:40,activeHat:"none",avatarId:"raccoon"}},{id:"p8",name:"Ice Specialist",config:{hue:190,skinHue:180,bgHue:200,bgSat:70,bgLight:90,activeHat:"none",avatarId:"bunny"}}],n=[{id:"none",name:"No Hat",src:"",style:""},{id:"hat1",name:"Helmet",src:"/images/hats/helmet1.png",style:"scale-[2.5] translate-y-[45%]"},{id:"hat2",name:"Fedora",src:"/images/hats/hat2.png",style:"scale-[0.9] -translate-y-[40%]"},{id:"hat3",name:"Top Hat",src:"/images/hats/tophat.png",style:"scale-[0.9] -translate-y-[40%]"},{id:"hat4",name:"Cowboy Hat",src:"/images/hats/cowboyhat.png",style:"scale-[0.9] -translate-y-[40%]"},{id:"hat5",name:"Dungan Doves Cap",src:"/images/hats/dungandoves.png",style:"scale-[0.9] -translate-y-[40%]"}],o=e=>{var t,a,l,o,c,d,u,x,h,m,p,b,g,f,v,w,y;let{userData:j,hue:N,skinHue:k,bgHue:S,bgSat:z,bgLight:_,hat:C,avatarId:E,className:P=""}=e,I=null!==(h=null!=N?N:null==j?void 0:null===(t=j.avatar)||void 0===t?void 0:t.hue)&&void 0!==h?h:0,M=null!==(m=null!=k?k:null==j?void 0:null===(a=j.avatar)||void 0===a?void 0:a.skinHue)&&void 0!==m?m:0,R=null!==(p=null!=S?S:null==j?void 0:null===(l=j.avatar)||void 0===l?void 0:l.bgHue)&&void 0!==p?p:260,D=null!==(b=null!=z?z:null==j?void 0:null===(o=j.avatar)||void 0===o?void 0:o.bgSat)&&void 0!==b?b:50,A=null!==(g=null!=_?_:null==j?void 0:null===(c=j.avatar)||void 0===c?void 0:c.bgLight)&&void 0!==g?g:20,H=null!==(f=null!=E?E:null==j?void 0:null===(d=j.avatar)||void 0===d?void 0:d.avatarId)&&void 0!==f?f:"bunny",X=s.find(e=>e.id===H)||s[0],T=(null==X?void 0:X.src)||"/images/avatar/spacebunny.png",L=null!==(y=null!==(w=null!==(v=null!=C?C:null==j?void 0:j.activeHat)&&void 0!==v?v:null==j?void 0:null===(u=j.avatar)||void 0===u?void 0:u.activeHat)&&void 0!==w?w:null==j?void 0:null===(x=j.avatar)||void 0===x?void 0:x.hat)&&void 0!==y?y:"none",F=n.find(e=>e.id===L),U=null==F?void 0:F.src,O=(null==F?void 0:F.style)||"scale-100";return(0,r.jsxs)("div",{className:"relative ".concat(P),style:{backgroundColor:"hsl(".concat(R,", ").concat(D,"%, ").concat(A,"%)")},children:[(0,r.jsx)("div",{className:"absolute inset-0 z-0",style:{backgroundColor:"hsl(".concat(M,", 70%, 50%)"),maskImage:"url(".concat((0,i.K)(T),")"),WebkitMaskImage:"url(".concat((0,i.K)(T),")"),maskSize:"cover"}}),(0,r.jsx)("img",{src:(0,i.K)(T),alt:"Avatar",className:"w-full h-full object-cover relative z-10",style:{filter:"hue-rotate(".concat(I,"deg)")}}),U&&(0,r.jsx)("img",{src:(0,i.K)(U),alt:"Accessory",className:"absolute inset-0 z-20 w-full h-full object-cover pointer-events-none transition-transform ".concat(O),onError:e=>console.error("Error loading hat:",U,(0,i.K)(U))})]})}},6678:function(e,t,a){a.r(t),a.d(t,{AuthProvider:function(){return u},useAuth:function(){return x}});var r=a(3827),i=a(4090),s=a(7065),l=a(8121),n=a(4499),o=a(7907),c=a(1657);let d=(0,i.createContext)({});function u(e){let{children:t}=e,[a,u]=(0,i.useState)(null),[x,h]=(0,i.useState)(null),[m,p]=(0,i.useState)(!0),b=(0,o.useRouter)();(0,i.useEffect)(()=>{let e=(0,s.Aj)(n.I8,async e=>{if(u(e),e)try{let a=(0,l.JU)(n.db,"users",e.uid),r=await (0,l.QT)(a);if(r.exists()){let t=r.data(),i="andrewpcarlson85@gmail.com"===e.email,s={};if(i&&"teacher"!==t.role&&(console.log("Fixing Admin Role for Legacy User"),t.role="teacher",s.role="teacher"),"teacher"===t.role&&!t.classCode){console.log("Generating Class Code for existing teacher");let e=(0,c.a)();t.classCode=e,s.classCode=e}if(Object.keys(s).length>0)try{await (0,l.pl)(a,s,{merge:!0})}catch(e){console.warn("Could not update user profile in DB",e)}h(t)}else{var t;e.email;let r={uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,role:"teacher",classCode:(0,c.a)(),status:"active",subscriptionStatus:"trial",schoolName:"",location:"earth",spaceship:{name:"SS "+((null===(t=e.displayName)||void 0===t?void 0:t.split(" ")[0])||"Voyager"),color:"text-blue-400",type:"scout",speed:1}};await (0,l.pl)(a,r),h(r)}}catch(t){console.error("Error fetching user data",t),"andrewpcarlson85@gmail.com"===e.email&&(console.log("Using Fallback Admin Profile due to DB error"),h({uid:e.uid,email:e.email,displayName:e.displayName,photoURL:e.photoURL,role:"teacher",status:"active",location:"earth",xp:9999,spaceship:{name:"SS Command (Fallback)",color:"text-yellow-400",type:"fighter",speed:2}}))}else h(null);p(!1)});return()=>e()},[]);let g=async()=>{try{await (0,s.rh)(n.I8,n.Vv)}catch(e){console.error("Login failed",e)}},f=async(e,t)=>{try{await (0,s.e5)(n.I8,e,t)}catch(e){throw console.error("Student Login Failed",e),e}},v=async()=>{await (0,s.w7)(n.I8),h(null),b.push("/")};return(0,r.jsx)(d.Provider,{value:{user:a,userData:x,loading:m,signInWithGoogle:g,signInStudent:f,logout:v},children:t})}let x=()=>(0,i.useContext)(d)},4499:function(e,t,a){a.d(t,{I8:function(){return d},Vv:function(){return u},db:function(){return c},qe:function(){return n}});var r=a(6142),i=a(8121),s=a(7065),l=a(3493);let n={apiKey:"AIzaSyDVHiiCHkP-RFOI26cIrD_OijLnw1r3B8Q",authDomain:"spaceadventure-7d540.firebaseapp.com",projectId:"spaceadventure-7d540",storageBucket:"spaceadventure-7d540.firebasestorage.app",messagingSenderId:"546441300465",appId:"1:546441300465:web:28ae387d2bdbb8011a1c50",measurementId:"G-8R9PYL00XH"},o=(0,r.C6)().length>0?(0,r.Mq)():(0,r.ZF)(n),c=(0,i.ad)(o),d=(0,s.v0)(o),u=new s.hJ;(0,l.Gb)().then(e=>{e&&(0,l.IH)(o)})},1657:function(e,t,a){a.d(t,{K:function(){return r},a:function(){return i}});let r=e=>{let t=e.startsWith("/")?e:"/".concat(e);return window.location.hostname.includes("github.io")?"https://shootyq.github.io/SpaceAdventure".concat(t):"".concat("").concat(t)},i=()=>{let e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",t="";for(let a=0;a<6;a++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}},2225:function(e,t,a){a.d(t,{H:function(){return r}});let r=[{id:"sun",name:"The Sun",color:"bg-yellow-500 shadow-[0_0_100px_#eab308]",size:"w-32 h-32",pixelSize:128,orbitSize:0,orbitDuration:0,startAngle:0,description:"The burning core of our system.",xpRequired:0},{id:"mercury",name:"Mercury",color:"bg-gray-400",size:"w-6 h-6",pixelSize:24,orbitSize:300,orbitDuration:3888,startAngle:45,description:"Hot, fast, and rocky.",xpRequired:100},{id:"venus",name:"Venus",color:"bg-orange-300",size:"w-8 h-8",pixelSize:32,orbitSize:450,orbitDuration:9963,startAngle:120,description:"Wrapped in thick clouds.",xpRequired:250},{id:"earth",name:"Earth",color:"bg-blue-500",size:"w-10 h-10",pixelSize:40,orbitSize:650,orbitDuration:16200,startAngle:200,description:"Home base.",xpRequired:0},{id:"mars",name:"Mars",color:"bg-red-500",size:"w-8 h-8",pixelSize:32,orbitSize:850,orbitDuration:30456,startAngle:300,description:"The Red Planet.",xpRequired:500},{id:"jupiter",name:"Jupiter",color:"bg-orange-200 shadow-inner",size:"w-24 h-24",pixelSize:96,orbitSize:1600,orbitDuration:192132,startAngle:60,description:"The Gas Giant.",xpRequired:1e3},{id:"saturn",name:"Saturn",color:"bg-yellow-200",size:"w-20 h-20",pixelSize:80,orbitSize:2400,orbitDuration:477252,startAngle:180,description:"Ringed majestic world.",xpRequired:2e3},{id:"uranus",name:"Uranus",color:"bg-cyan-300",size:"w-14 h-14",pixelSize:56,orbitSize:3400,orbitDuration:1360962,startAngle:270,description:"The Ice Giant.",xpRequired:3500},{id:"neptune",name:"Neptune",color:"bg-blue-700",size:"w-14 h-14",pixelSize:56,orbitSize:4400,orbitDuration:2669760,startAngle:90,description:"Windy and dark.",xpRequired:5e3}]}}]);